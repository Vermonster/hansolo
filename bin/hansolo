#!/usr/bin/env ruby
$: << File.expand_path(File.join(__FILE__, '..', '..', 'lib'))

require 'hansolo/cli/solo'
require 'optparse'

conf_filename = File.expand_path("Hanfile")
load conf_filename if File.exists?(conf_filename)

options = {}

optparse = OptionParser.new do |opts|
  opts.banner = Hansolo::Solo.banner

  opts.on( '-h', '--help', 'Display this screen' ) do
    puts opts
    puts "\n"
    puts Hansolo::Cli.help
    exit
  end

  opts.on( '-u', '--urls a,b,c', Array, "Comma-sep list of urls, e.g.: user@host:port/dest/path") do |o|
    options[:urls] = o
  end

  opts.on( '-k', '--keydir s', String, "Your local ssh key directory") do |o|
    options[:keydir] = o
  end

  opts.on( '-a', '--app s', String, "The application name") do |o|
    options[:app] = o
  end

  opts.on( '-r', '--runlist a,b,c', Array, "The runlist you want to effect on the target(s)") do |o|
    options[:runlist] = o
  end
end.parse!(ARGV)

opts = options.inject({}){|m,(k,v)| m[k.to_sym] = v; m}
puts opts.inspect
Hansolo::Solo.new(opts).run!
